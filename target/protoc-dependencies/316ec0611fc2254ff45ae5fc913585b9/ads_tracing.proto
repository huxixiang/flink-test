// 本文件存储链路tracing功能所用到的PB定义，详见https://xiaohongshu.quip.com/J92UAgX2Fpt5/20
syntax = "proto3";
option java_package = "com.xiaohongshu.ads.tracing";
option java_outer_classname = "AdsTracingSchema";

message TracingStat {
    int32 trace_point = 1;
    int64 count = 2;
    double total_score = 3;
    // ms
    uint64 timestamp = 4;
    int32 type = 5;
}

message SearchSummary {
    repeated SearchMCB summaries = 1;
}

message SearchMCB {
    SearchMCBKey key = 1;
    repeated TracingStat stats = 2;
}

message SearchMCBKey {
    int64 adv_id = 1;
    int64 camp_id = 2;
    int64 unit_id = 3;
    int32 exp_id = 4;
    string bidword = 5;
}

// 实验结构，oneof vs bytes
message CommonStruct {
    bytes serial_key = 1;
    // 不同的key类型或oneof取值，通过type区分
    // 最好直接是ClassName，不需要额外指定
    string type = 2;
    repeated TracingStat stats = 3;

    // start from 10
    oneof KeyType {
        SearchMCBKey search_mcb_key = 10;
    }
}

message CommonSummary {
    repeated CommonStruct summaries = 1;
}