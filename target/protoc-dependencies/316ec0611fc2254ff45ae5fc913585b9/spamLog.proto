syntax = "proto3";

option java_package = "com.xiaohongshu.ads.feeds.spam.log";
option java_outer_classname = "AdsSpamLog";


enum StepInfo {
  UNKNOWN_STEP = 0;
  RECALL_ADS_STEP = 1;
  PRE_RANKING_STEP = 4;
  RANKING_STEP = 7;
  POST_RANKING_STEP = 10;
  AUCTION_PRICE_STEP = 13;
  INSERT_POSITION_STEP = 16;
}

enum GenderType {
  UNKNOWN_GENDER = 0;
  MALE = 1;
  FEMALE = 2;
}


enum AdPlacementType {
  UNKNOWN_PLACEMENT = 0;
  EXPLORE = 1;
  SEARCH = 2;
  SEARCH_GOODS = 3;
}

enum CityTierType {
  UNKNOWN_TIER = 0;
  FIRST_TIER = 1;
  NEW_FIRST_TIER = 2;
  OTHER = 3;
  SECOND_TIER = 4;
  THIRD_TIER = 5;
  FORTH_TIER = 6;
  FIFTH_TIER = 7;
  OVERSEAS = 8;
}

message UserInfo {
  string user_id = 1;
  GenderType gender = 2;
  int32 age = 3;
  AppInfo app = 4;
  LocationInfo location = 5;
  LocationInfo gx_location = 6;
}

message DeviceInfo {
  string platform = 1;
  string manufacturer = 2;
  string device_model = 3;
}

message AppInfo {
  int32 app_first_time = 1;
  DeviceInfo device = 2;
  string register_channel = 3;
  bool new_user = 4;
  string app_build = 5;
}

message LocationInfo {
  string country = 1;
  string province = 2;
  string city = 3;
  CityTierType city_tier = 4;
}

enum SpamReason {
  UNKNOWN_REASON = 0;

  // STEP1
  EXPANDED_KEYWORD_INDEX = 100;
  EXPANDED_KEYWORD_INDEX_2 = 101;
  RECALL_BY_PLACEMENT = 102;

  //STEP2
  TARGET_AUDIENCE_FILTER = 400;
  FREQUENCY_FILTER = 401;
  BUDGET_PACING_FILTER_FEEDS = 402;
  BIDDING_STRATEGY_LOG = 403;
  GOODS_STOCK_FILTER = 404;
  AFTER_PRE_RANKING = 405;

  //STEP3
  UPDATE_RANKING_CAPPING = 700;
  AFTER_RANKING = 701;

  //STEP4
  BUDGET_PACING_FILTER_SEARCH = 1000;
  NOTE_DEDUP_FILTER = 1001;
  MIN_CPM_FILTER = 1002;
  GD_CPD_ROUND_ROBIN_FILTER = 1003;
  GD_CPD_POSITION_FILTER = 1004;
  CAMPAIGN_DEDUP_FILTER = 1005;
  ADVERTISER_DEDUP_FILTER = 1006;
  RELEVANCE_FILTER = 1007;
  RELEVANCE_FILTER_2 = 1008;
  RELEVANCE_FILTER_GOODS1 = 1009;
  RELEVANCE_FILTER_GOODS2 = 1010;
  RELEVANCE_BLACKLIST_FILTER = 1011;
  AFTER_POST_RANKING = 1012;

  //STEP5
  AUCTION_FILTER = 1300;
  AFTER_AUCTION_PRICE = 1301;

  //STEP6
  POSITION_FILTER = 1600;
  AFTER_INSERT_POSITION = 1601;
}

message AdsSpamLogInfo {
  string request_id = 1;
  int64 request_timestamp = 2;
  SpamReason spam_reason = 3;
  string spam_before_creative_ids = 4;
  string spam_after_creative_ids = 5;
  AdPlacementType placement = 6;
  UserInfo user_info = 7;
  StepInfo step_info = 8;
  string query_string = 9;
  LogSource log_source = 10;
}


enum LogSource {
  ADS_SERVICE = 0;
  DOLPHIN = 1;
  JARVIS = 2;
}


message InsertSpamData {
  string request_id = 12;
  string dtm = 1;
  int32 hour = 2;
  int32 minute = 3;
  int32 advertiser_id = 4;
  int32 campaign_id = 5;
  int32 unit_id = 6;
  int32 creative_id = 7;
  string advertiser_name = 8;
  string campaign_name = 9;
  string unit_name = 10;
  string creative_name = 11;
  string step = 14;
  string log_source = 15;
  string placement = 16;
  string query_string = 17;
  int32 field_code = 30;
}
