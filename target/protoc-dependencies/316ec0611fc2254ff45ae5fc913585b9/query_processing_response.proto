syntax = "proto3";

option java_package = "red.sns.search.server.log.schema";
option java_outer_classname = "QueryProcessingResponseInfo";

message QueryProcessingResponse {
    string search_id = 1;
    string ordinary_query = 2;

    // sort type
    NoteSortType note_sort_type = 5;

    // filters
    repeated FilterOption filter_options = 9; // 原始的 filter options

    NoteType note_type_filter = 6;
    repeated string search_note_keywords_filter = 7;
    repeated string search_note_keywords_category_filter = 8;

    QueryRewriteResponse query_rewrite_response = 10;

    message FilterOption {
        string type = 1;
        repeated string tags = 2;
    }
}

message QueryRewriteResponse {
    message QueryTerm {
        string text = 1;
        float weight = 2;
    }

    enum QueryRewriteStrategy {
        NONE = 0;
        GENDER_SENSITIVE = 1;
        SEASON_SENSITIVE = 2;
    }

    string normalized_query = 1;
    string corrected_query = 2;

    repeated string taxonomy = 3; // taxonomy id list
    repeated string entities = 4; // entities id list

    repeated QueryRewriteStrategy rewrite_strategy = 6;
    repeated QueryTerm query_terms = 7;
}

// from https://code.devops.xiaohongshu.com/data/tracker/blob/master/tracker-builder/src/main/proto/tracker.proto

enum NoteType {
    DEFAULT_6 = 0;
    short_note = 1;
    long_note = 2;
    video_note = 3;
}

enum NoteSortType {
    DEFAULT_18 = 0;
    NOTE_SORT_BY_TRENDING = 1;
    NOTE_SORT_BY_CREATE_TIME = 2;
    NOTE_SORT_BY_AI = 3;
    NOTE_SORT_BY_POPULARITY = 4;
}
